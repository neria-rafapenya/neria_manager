CREATE TABLE IF NOT EXISTS tenant_service_email_messages (
  id VARCHAR(36) NOT NULL,
  tenantId VARCHAR(36) NOT NULL,
  serviceCode VARCHAR(64) NOT NULL,
  accountId VARCHAR(36) NOT NULL,
  messageKey VARCHAR(128) NOT NULL,
  messageId VARCHAR(255) NULL,
  subject VARCHAR(255) NULL,
  fromName VARCHAR(255) NULL,
  fromEmail VARCHAR(255) NULL,
  receivedAt TIMESTAMP NULL,
  bodyText TEXT NULL,
  status VARCHAR(32) NOT NULL,
  intent VARCHAR(64) NULL,
  priority VARCHAR(32) NULL,
  classification JSON NULL,
  actionType VARCHAR(64) NULL,
  actionStatus VARCHAR(32) NULL,
  jiraIssueKey VARCHAR(64) NULL,
  jiraIssueUrl VARCHAR(255) NULL,
  errorMessage TEXT NULL,
  createdAt TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  UNIQUE KEY uq_tenant_service_email_messages (tenantId, accountId, messageKey),
  INDEX idx_tenant_service_email_messages_tenant (tenantId),
  INDEX idx_tenant_service_email_messages_service (serviceCode),
  INDEX idx_tenant_service_email_messages_received (receivedAt)
);
